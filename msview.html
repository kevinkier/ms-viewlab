<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyShift YouTube View LAB</title>
    <style>
        /* ========== CSS ë³€ìˆ˜ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ========== */
        :root {
            --primary-color: #ff0000;
            --primary-hover: #cc0000;
            --bg-color: #000000;
            --card-bg: #1a1a1a;
            --border-color: #333333;
            --text-color: #ffffff;
            --text-secondary: #b0b0b0;
            --highlight-color: #ffeb3b;
            --success-color: #4caf50;
            --error-color: #f44336;
            --shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h1 .logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-style: italic;
            color: #333;
            font-size: 0.7rem;
            padding: 5px;
            text-align: center;
            line-height: 1.1;
        }

        .notice {
            background-color: #2a2a00;
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #ffd54f;
        }

        /* ========== ê²€ìƒ‰ í¼ ========== */
        .search-section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        input[type="text"],
        input[type="date"],
        select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
        }

        .btn-secondary {
            background-color: #757575;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #616161;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #45a049;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ========== ì œì–´ íŒ¨ë„ ========== */
        .controls {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .view-toggle {
            display: flex;
            gap: 8px;
        }

        .view-toggle button {
            padding: 8px 16px;
            background-color: white;
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }

        .view-toggle button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .filter-box {
            display: flex;
            gap: 8px;
            flex: 1;
            min-width: 250px;
        }

        .filter-box input {
            flex: 1;
        }

        /* ========== ë¡œë”© ë° ì—ëŸ¬ ========== */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            background-color: #2a1a1a;
            border-left: 4px solid var(--error-color);
            padding: 16px;
            margin-bottom: 24px;
            border-radius: 4px;
        }

        .error-message.show {
            display: block;
        }

        .error-message h3 {
            color: var(--error-color);
            margin-bottom: 8px;
        }

        /* ========== ê²°ê³¼ ì •ë³´ ========== */
        .results-info {
            background: var(--card-bg);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .results-info.show {
            display: flex;
        }

        /* ========== í…Œì´ë¸” ë·° ========== */
        .table-container {
            overflow-x: auto;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1380px;
            table-layout: fixed;
        }

        thead {
            background-color: #2a2a2a;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            border-bottom: 2px solid var(--border-color);
        }

        th:hover {
            background-color: #333333;
        }

        th.sortable::after {
            content: ' â†•';
            opacity: 0.3;
            font-size: 0.8rem;
        }

        th.sort-asc::after {
            content: ' â†‘';
            opacity: 1;
            color: var(--primary-color);
        }

        th.sort-desc::after {
            content: ' â†“';
            opacity: 1;
            color: var(--primary-color);
        }

        /* ì»¬ëŸ¼ ë„ˆë¹„ ì„¤ì • */
        th:nth-child(1), td:nth-child(1) { width: 350px; } /* ì¸ë„¤ì¼+ì œëª© */
        th:nth-child(2), td:nth-child(2) { width: 120px; } /* ì±„ë„ */
        th:nth-child(3), td:nth-child(3) { width: 100px; } /* ê²Œì‹œì¼ */
        th:nth-child(4), td:nth-child(4) { width: 70px; }  /* ê²½ê³¼ì¼ */
        th:nth-child(5), td:nth-child(5) { width: 60px; }  /* í˜•ì‹ */
        th:nth-child(6), td:nth-child(6) { width: 70px; }  /* ì¬ìƒì‹œê°„ */
        th:nth-child(7), td:nth-child(7) { width: 90px; }  /* ì¡°íšŒìˆ˜ */
        th:nth-child(8), td:nth-child(8) { width: 90px; }  /* ì¼í‰ê·  */
        th:nth-child(9), td:nth-child(9) { width: 70px; }  /* ì¢‹ì•„ìš” */
        th:nth-child(10), td:nth-child(10) { width: 70px; } /* ì°¸ì—¬ìœ¨ */
        th:nth-child(11), td:nth-child(11) { width: 90px; } /* ì„±ê³¼ë“±ê¸‰ */
        th:nth-child(12), td:nth-child(12) { width: 200px; } /* íƒœê·¸ */

        td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        /* ì¸ë„¤ì¼+ì œëª© ì»¬ëŸ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        td:nth-child(1) {
            padding: 6px;
        }

        .thumbnail-title-cell {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .thumbnail-wrapper {
            flex-shrink: 0;
        }

        .thumbnail-wrapper img {
            width: 150px;
            height: 84px;
            object-fit: cover;
            border-radius: 4px;
        }

        .title-content {
            flex: 1;
            min-width: 0;
        }

        /* íƒœê·¸ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ */
        td:nth-child(12) {
            max-width: 0;
            overflow-x: auto;
            white-space: nowrap;
        }

        td:nth-child(12)::-webkit-scrollbar {
            height: 6px;
        }

        td:nth-child(12)::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }

        td:nth-child(12)::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        tbody tr:hover {
            background-color: #252525;
        }

        .video-title {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .video-title:hover {
            text-decoration: underline;
        }

        .video-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.3;
        }

        .video-tags {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        mark {
            background-color: var(--highlight-color);
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 600;
        }

        code {
            background-color: #2a2a2a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #00ff00;
        }

        /* ========== ì¹´ë“œ ë·° ========== */
        .cards-container {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .cards-container.show {
            display: grid;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .card-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #e0e0e0;
        }

        .card-content {
            padding: 16px;
        }

        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-title a {
            color: inherit;
            text-decoration: none;
        }

        .card-title a:hover {
            color: var(--primary-color);
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .card-channel {
            font-weight: 600;
            color: var(--text-color);
        }

        .card-stats {
            display: flex;
            gap: 12px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* ========== í˜ì´ì§€ë„¤ì´ì…˜ ========== */
        .pagination {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 24px;
            padding: 20px;
        }

        .pagination.show {
            display: flex;
        }

        .pagination button {
            padding: 10px 20px;
        }

        .page-info {
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* ========== ë°˜ì‘í˜• ========== */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .view-toggle {
                justify-content: center;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group button {
                width: 100%;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px;
            }

            .cards-container {
                grid-template-columns: 1fr;
            }

            .results-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        /* ========== ìœ í‹¸ë¦¬í‹° ========== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <!--
    ==================================================================================
    MoneyShift YouTube View LAB v1.0
    ==================================================================================
    
    [ì‚¬ìš©ë²•]
    1. ì•„ë˜ YT_API_KEY ë³€ìˆ˜ì— ë³¸ì¸ì˜ YouTube Data API v3 í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
       - API í‚¤ ë°œê¸‰: https://console.cloud.google.com/apis/credentials
       - YouTube Data API v3ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.
    
    2. ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸í•  ë•Œ:
       - index.html íŒŒì¼ì„ ë”ë¸”í´ë¦­í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì—½ë‹ˆë‹¤.
       - ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” file:// í”„ë¡œí† ì½œì—ì„œ CORS ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
       - Chromeì˜ ê²½ìš°: --allow-file-access-from-files í”Œë˜ê·¸ë¡œ ì‹¤í–‰í•˜ê±°ë‚˜
         ê°„ë‹¨í•œ ë¡œì»¬ ì„œë²„(ì˜ˆ: python -m http.server)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
    
    3. ë°°í¬ ì‹œ:
       - GitHub Pages, Netlify, Vercel ë“±ì— ë°°í¬í•˜ì„¸ìš”.
       - Google Cloud Consoleì—ì„œ API í‚¤ì— HTTP referrer ì œí•œì„ ì„¤ì •í•˜ì„¸ìš”.
       - ì˜ˆ: https://yourdomain.com/*
    
    [í• ë‹¹ëŸ‰ ë° ì œí•œì‚¬í•­]
    - YouTube Data API v3ëŠ” ì¼ì¼ í• ë‹¹ëŸ‰ì´ ìˆìŠµë‹ˆë‹¤ (ê¸°ë³¸ 10,000 ë‹¨ìœ„/ì¼).
    - search.listëŠ” 100 ë‹¨ìœ„, videos.listëŠ” 1 ë‹¨ìœ„ë¥¼ ì†Œë¹„í•©ë‹ˆë‹¤.
    - íƒœê·¸ëŠ” ëª¨ë“  ì˜ìƒì— ìˆì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ë¹„ê³µê°œ/ì‚­ì œëœ ì˜ìƒì€ ê²€ìƒ‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    
    [í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤]
    1. í‚¤ì›Œë“œ "coffee" ê²€ìƒ‰, ì •ë ¬ "ì¡°íšŒìˆ˜", 50ê±´ ìš”ì²­ í›„ í˜ì´ì§€ ë„˜ê¹€
    2. ì±„ë„IDë§Œ ì…ë ¥í•˜ê³  í‚¤ì›Œë“œ ê³µë€ìœ¼ë¡œ í•´ë‹¹ ì±„ë„ì˜ ìµœì‹  ì—…ë¡œë“œ ê²€ìƒ‰
    3. ê¸°ê°„ í•„í„°ë¡œ ì§€ë‚œ 7ì¼ ë‚´ ì—…ë¡œë“œë§Œ ê²€ìƒ‰
    4. CSV ë‹¤ìš´ë¡œë“œ í›„ Excelì—ì„œ í•œê¸€/ì½¤ë§ˆ/ì¤„ë°”ê¿ˆ ì •ìƒ í™•ì¸
    5. í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë¡œ ê²°ê³¼ ë‚´ ì¬ê²€ìƒ‰
    
    [ì£¼ì˜ì‚¬í•­]
    - API í‚¤ë¥¼ ê³µê°œ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”!
    - .env íŒŒì¼ì´ë‚˜ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
    - ì´ íŒŒì¼ì€ ê°œë°œ/í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.
    ==================================================================================
    -->

    <div class="container">
        <h1>
            <span class="logo">money<br>shift</span>
            YouTube View LAB
        </h1>
        
        <div class="notice">
            âš ï¸ <strong>ì£¼ì˜:</strong> ë¡œì»¬ file:// í™˜ê²½ì—ì„œëŠ” CORS ì œí•œìœ¼ë¡œ ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
            ë°°í¬ ì‹œ GitHub Pagesë‚˜ Netlifyë¥¼ ê¶Œì¥í•˜ë©°, API í‚¤ì— HTTP referrer ì œí•œì„ ì„¤ì •í•˜ì„¸ìš”.
        </div>

        <!-- ê²€ìƒ‰ í¼ -->
        <section class="search-section">
            <h2>ê²€ìƒ‰ ì˜µì…˜</h2>
            <form id="searchForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="keyword">ê²€ìƒ‰ í‚¤ì›Œë“œ</label>
                        <input type="text" id="keyword" placeholder="ì˜ˆ: ì»¤í”¼ ë§Œë“¤ê¸°" aria-label="ê²€ìƒ‰ í‚¤ì›Œë“œ">
                    </div>
                    <div class="form-group">
                        <label for="channelId">ì±„ë„ ID (ì„ íƒ)</label>
                        <input type="text" id="channelId" placeholder="ì˜ˆ: UCXuqSBlHAE6Xw-yeJA0Tunw" aria-label="ì±„ë„ ID">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="publishedAfter">ê²Œì‹œì¼ ì‹œì‘</label>
                        <input type="date" id="publishedAfter" aria-label="ê²Œì‹œì¼ ì‹œì‘">
                    </div>
                    <div class="form-group">
                        <label for="publishedBefore">ê²Œì‹œì¼ ì¢…ë£Œ</label>
                        <input type="date" id="publishedBefore" aria-label="ê²Œì‹œì¼ ì¢…ë£Œ">
                    </div>
                    <div class="form-group">
                        <label for="order">ì •ë ¬ ê¸°ì¤€</label>
                        <select id="order" aria-label="ì •ë ¬ ê¸°ì¤€">
                            <option value="relevance">ê´€ë ¨ì„±</option>
                            <option value="date">ìµœì‹ ìˆœ</option>
                            <option value="viewCount">ì¡°íšŒìˆ˜</option>
                            <option value="rating">í‰ì </option>
                            <option value="title">ì œëª©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maxResults">ìµœëŒ€ ê°œìˆ˜</label>
                        <select id="maxResults" aria-label="ìµœëŒ€ ê°œìˆ˜">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-primary" aria-label="ê²€ìƒ‰ ì‹¤í–‰">
                        ğŸ” ê²€ìƒ‰
                    </button>
                    <button type="button" id="resetBtn" class="btn-secondary" aria-label="ê²€ìƒ‰ ì¡°ê±´ ì´ˆê¸°í™”">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                </div>
            </form>
        </section>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div id="errorMessage" class="error-message" role="alert">
            <h3>âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h3>
            <p id="errorText"></p>
        </div>

        <!-- ë¡œë”© -->
        <div id="loading" class="loading" role="status" aria-live="polite">
            <div class="spinner"></div>
            <p>ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ê²°ê³¼ ì •ë³´ -->
        <div id="resultsInfo" class="results-info">
            <div>
                <strong id="resultCount">0</strong>ê°œì˜ ê²°ê³¼
            </div>
            <div class="button-group">
                <button id="exportCsvBtn" class="btn-success" aria-label="CSVë¡œ ë‚´ë³´ë‚´ê¸°">
                    ğŸ’¾ CSV ë‹¤ìš´ë¡œë“œ
                </button>
                <button id="copyAllBtn" class="btn-success" aria-label="ì „ì²´ ë³µì‚¬">
                    ğŸ“‹ ì „ì²´ ë³µì‚¬
                </button>
            </div>
        </div>

        <!-- ì œì–´ íŒ¨ë„ -->
        <div id="controls" class="controls hidden">
            <div class="view-toggle">
                <button id="tableViewBtn" class="active" aria-label="í…Œì´ë¸” ë³´ê¸°">ğŸ“Š í…Œì´ë¸”</button>
                <button id="cardViewBtn" aria-label="ì¹´ë“œ ë³´ê¸°">ğŸƒ ì¹´ë“œ</button>
            </div>
            <div class="filter-box">
                <input type="text" id="clientFilter" placeholder="ê²°ê³¼ ë‚´ ê²€ìƒ‰..." aria-label="ê²°ê³¼ ë‚´ ê²€ìƒ‰">
                <button id="clearFilterBtn" class="btn-secondary" aria-label="í•„í„° ì´ˆê¸°í™”">âœ•</button>
            </div>
        </div>

        <!-- í…Œì´ë¸” ë·° -->
        <div id="tableView" class="table-container">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="title">ì¸ë„¤ì¼ / ì œëª©</th>
                        <th class="sortable" data-sort="channel">ì±„ë„</th>
                        <th class="sortable" data-sort="publishedAt">ê²Œì‹œì¼</th>
                        <th class="sortable" data-sort="daysAgo">ê²½ê³¼ì¼</th>
                        <th>í˜•ì‹</th>
                        <th class="sortable" data-sort="duration">ì¬ìƒì‹œê°„</th>
                        <th class="sortable" data-sort="viewCount">ì¡°íšŒìˆ˜</th>
                        <th class="sortable" data-sort="avgViews">ì¼í‰ê· </th>
                        <th class="sortable" data-sort="likeCount">ì¢‹ì•„ìš”</th>
                        <th class="sortable" data-sort="engagement">ì°¸ì—¬ìœ¨</th>
                        <th class="sortable" data-sort="grade">ì„±ê³¼ë“±ê¸‰</th>
                        <th>íƒœê·¸</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
        </div>

        <!-- ì¹´ë“œ ë·° -->
        <div id="cardView" class="cards-container">
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="pagination" class="pagination">
            <button id="prevBtn" class="btn-secondary" disabled aria-label="ì´ì „ í˜ì´ì§€">â—€ ì´ì „</button>
            <span class="page-info" id="pageInfo">í˜ì´ì§€ 1</span>
            <button id="nextBtn" class="btn-secondary" disabled aria-label="ë‹¤ìŒ í˜ì´ì§€">ë‹¤ìŒ â–¶</button>
        </div>
    </div>

    <script>
        /**
         * ==================================================================================
         * YouTube ê²€ìƒ‰ í”„ë¡œê·¸ë¨ - JavaScript
         * ==================================================================================
         */

        // ========== ì„¤ì • ë° ìƒìˆ˜ ==========
        
        /**
         * YouTube Data API v3 í‚¤ - ë³¸ì¸ì˜ í‚¤ë¡œ êµì²´í•˜ì„¸ìš”!
         * @constant {string}
         */
        const YT_API_KEY = "AIzaSyCrJVaBxOfloD_qD_vijI6x3y47K8Er4BE";

        /**
         * API ì—”ë“œí¬ì¸íŠ¸
         * @constant {Object}
         */
        const API_ENDPOINTS = {
            SEARCH: "https://www.googleapis.com/youtube/v3/search",
            VIDEOS: "https://www.googleapis.com/youtube/v3/videos"
        };

        /**
         * ê¸°ë³¸ ì„¤ì •ê°’
         * @constant {Object}
         */
        const DEFAULTS = {
            MAX_RESULTS: 25,
            ORDER: "relevance",
            REGION_CODE: "KR",
            RELEVANCE_LANGUAGE: "ko"
        };

        // ========== ì „ì—­ ìƒíƒœ ==========
        
        /**
         * ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ê´€ë¦¬
         * @type {Object}
         */
        const appState = {
            currentResults: [],      // í˜„ì¬ ê²€ìƒ‰ ê²°ê³¼
            filteredResults: [],     // í•„í„°ë§ëœ ê²°ê³¼
            allResults: [],          // ëª¨ë“  ê²°ê³¼ (í˜ì´ì§€ë„¤ì´ì…˜ìš©)
            nextPageToken: null,     // ë‹¤ìŒ í˜ì´ì§€ í† í°
            prevPageToken: null,     // ì´ì „ í˜ì´ì§€ í† í°
            currentPage: 1,          // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
            currentQuery: null,      // í˜„ì¬ ê²€ìƒ‰ ì¿¼ë¦¬
            currentView: "table",    // í˜„ì¬ ë³´ê¸° ëª¨ë“œ (table/card)
            currentSortKey: null,    // í˜„ì¬ ì •ë ¬ í‚¤
            currentSortOrder: "asc", // í˜„ì¬ ì •ë ¬ ìˆœì„œ
            searchKeyword: ""        // ê²€ìƒ‰ í‚¤ì›Œë“œ (í•˜ì´ë¼ì´íŠ¸ìš©)
        };

        // ========== DOM ìš”ì†Œ ì°¸ì¡° ==========
        
        const elements = {
            searchForm: document.getElementById("searchForm"),
            resetBtn: document.getElementById("resetBtn"),
            loading: document.getElementById("loading"),
            errorMessage: document.getElementById("errorMessage"),
            errorText: document.getElementById("errorText"),
            resultsInfo: document.getElementById("resultsInfo"),
            resultCount: document.getElementById("resultCount"),
            controls: document.getElementById("controls"),
            tableView: document.getElementById("tableView"),
            cardView: document.getElementById("cardView"),
            resultsBody: document.getElementById("resultsBody"),
            pagination: document.getElementById("pagination"),
            prevBtn: document.getElementById("prevBtn"),
            nextBtn: document.getElementById("nextBtn"),
            pageInfo: document.getElementById("pageInfo"),
            tableViewBtn: document.getElementById("tableViewBtn"),
            cardViewBtn: document.getElementById("cardViewBtn"),
            clientFilter: document.getElementById("clientFilter"),
            clearFilterBtn: document.getElementById("clearFilterBtn"),
            exportCsvBtn: document.getElementById("exportCsvBtn"),
            copyAllBtn: document.getElementById("copyAllBtn")
        };

        // ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========

        /**
         * ISO 8601 durationì„ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
         * @param {string} duration - ISO 8601 í˜•ì‹ (ì˜ˆ: PT1H2M30S)
         * @returns {string} í¬ë§·ëœ ì‹œê°„ (ì˜ˆ: 1:02:30 ë˜ëŠ” 2:30)
         */
        function formatDuration(duration) {
            if (!duration) return "0:00";
            
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return "0:00";

            const hours = parseInt(match[1] || 0);
            const minutes = parseInt(match[2] || 0);
            const seconds = parseInt(match[3] || 0);

            if (hours > 0) {
                return `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            } else {
                return `${minutes}:${String(seconds).padStart(2, '0')}`;
            }
        }

        /**
         * ìˆ«ìë¥¼ í•œêµ­ì‹ ë‹¨ìœ„ë¡œ í¬ë§· (ì˜ˆ: 1234 â†’ 1.2ì²œíšŒ, 12345 â†’ 1.2ë§ŒíšŒ)
         * @param {number|string} num - í¬ë§·í•  ìˆ«ì
         * @returns {string} í¬ë§·ëœ ë¬¸ìì—´
         */
        function formatNumber(num) {
            if (!num) return "0íšŒ";
            const number = parseInt(num);
            
            if (number >= 100000000) {
                return (number / 100000000).toFixed(1).replace(/\.0$/, '') + 'ì–µíšŒ';
            } else if (number >= 10000) {
                return (number / 10000).toFixed(1).replace(/\.0$/, '') + 'ë§ŒíšŒ';
            } else if (number >= 1000) {
                return (number / 1000).toFixed(1).replace(/\.0$/, '') + 'ì²œíšŒ';
            } else {
                return number + 'íšŒ';
            }
        }

        /**
         * ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ í¬ë§·
         * @param {string} dateString - ISO ë‚ ì§œ ë¬¸ìì—´
         * @returns {string} í¬ë§·ëœ ë‚ ì§œ
         */
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\. /g, '-').replace('.', '');
        }

        /**
         * í…ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œë¥¼ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
         * @param {string} text - ì›ë³¸ í…ìŠ¤íŠ¸
         * @param {string} keyword - í•˜ì´ë¼ì´íŠ¸í•  í‚¤ì›Œë“œ
         * @returns {string} HTML ë¬¸ìì—´
         */
        function highlightKeyword(text, keyword) {
            if (!text || !keyword) return text || "";
            
            const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedKeyword})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        /**
         * HTML ë¬¸ìì—´ì„ ì´ìŠ¤ì¼€ì´í”„
         * @param {string} text - ì´ìŠ¤ì¼€ì´í”„í•  í…ìŠ¤íŠ¸
         * @returns {string} ì´ìŠ¤ì¼€ì´í”„ëœ í…ìŠ¤íŠ¸
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * CSVìš© ë¬¸ìì—´ ì´ìŠ¤ì¼€ì´í”„ (ë”°ì˜´í‘œ, ì½¤ë§ˆ, ì¤„ë°”ê¿ˆ ì²˜ë¦¬)
         * @param {string} text - ì´ìŠ¤ì¼€ì´í”„í•  í…ìŠ¤íŠ¸
         * @returns {string} ì´ìŠ¤ì¼€ì´í”„ëœ í…ìŠ¤íŠ¸
         */
        function escapeCsv(text) {
            if (!text) return "";
            text = String(text);
            if (text.includes('"') || text.includes(',') || text.includes('\n')) {
                return `"${text.replace(/"/g, '""')}"`;
            }
            return text;
        }

        /**
         * ë¡œë”© ìƒíƒœ í‘œì‹œ/ìˆ¨ê¹€
         * @param {boolean} show - í‘œì‹œ ì—¬ë¶€
         */
        function showLoading(show) {
            elements.loading.classList.toggle("show", show);
        }

        /**
         * ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
         * @param {string} message - ì—ëŸ¬ ë©”ì‹œì§€
         */
        function showError(message) {
            elements.errorText.textContent = message;
            elements.errorMessage.classList.add("show");
            console.error("Error:", message);
        }

        /**
         * ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¹€
         */
        function hideError() {
            elements.errorMessage.classList.remove("show");
        }

        // ========== API í˜¸ì¶œ í•¨ìˆ˜ ==========

        /**
         * ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ìƒì„±
         * @param {Object} formData - í¼ ë°ì´í„°
         * @param {string|null} pageToken - í˜ì´ì§€ í† í°
         * @returns {URLSearchParams} URL íŒŒë¼ë¯¸í„°
         */
        function buildSearchParams(formData, pageToken = null) {
            const params = new URLSearchParams({
                key: YT_API_KEY,
                part: "snippet",
                type: "video",
                maxResults: formData.maxResults || DEFAULTS.MAX_RESULTS,
                order: formData.order || DEFAULTS.ORDER,
                regionCode: DEFAULTS.REGION_CODE,
                relevanceLanguage: DEFAULTS.RELEVANCE_LANGUAGE
            });

            if (formData.keyword) {
                params.append("q", formData.keyword);
            }

            if (formData.channelId) {
                params.append("channelId", formData.channelId);
            }

            if (formData.publishedAfter) {
                params.append("publishedAfter", new Date(formData.publishedAfter).toISOString());
            }

            if (formData.publishedBefore) {
                const date = new Date(formData.publishedBefore);
                date.setHours(23, 59, 59, 999);
                params.append("publishedBefore", date.toISOString());
            }

            if (pageToken) {
                params.append("pageToken", pageToken);
            }

            return params;
        }

        /**
         * YouTube ê²€ìƒ‰ API í˜¸ì¶œ (1ì°¨)
         * @param {URLSearchParams} params - ê²€ìƒ‰ íŒŒë¼ë¯¸í„°
         * @returns {Promise<Object>} ê²€ìƒ‰ ê²°ê³¼
         */
        async function fetchSearch(params) {
            try {
                const url = `${API_ENDPOINTS.SEARCH}?${params.toString()}`;
                const response = await fetch(url);

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error("Search API Error:", error);
                throw error;
            }
        }

        /**
         * YouTube ë¹„ë””ì˜¤ ìƒì„¸ ì •ë³´ API í˜¸ì¶œ (2ì°¨)
         * @param {string[]} videoIds - ë¹„ë””ì˜¤ ID ë°°ì—´
         * @returns {Promise<Object>} ë¹„ë””ì˜¤ ìƒì„¸ ì •ë³´
         */
        async function fetchVideos(videoIds) {
            try {
                const params = new URLSearchParams({
                    key: YT_API_KEY,
                    part: "snippet,contentDetails,statistics",
                    id: videoIds.join(",")
                });

                const url = `${API_ENDPOINTS.VIDEOS}?${params.toString()}`;
                const response = await fetch(url);

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error("Videos API Error:", error);
                throw error;
            }
        }

        /**
         * ê²€ìƒ‰ ê²°ê³¼ì™€ ë¹„ë””ì˜¤ ìƒì„¸ ì •ë³´ ë³‘í•©
         * @param {Object} searchResults - ê²€ìƒ‰ ê²°ê³¼
         * @param {Object} videoDetails - ë¹„ë””ì˜¤ ìƒì„¸ ì •ë³´
         * @returns {Array} ë³‘í•©ëœ ê²°ê³¼ ë°°ì—´
         */
        function mergeResults(searchResults, videoDetails) {
            const videoMap = new Map(
                videoDetails.items.map(video => [video.id, video])
            );

            const now = new Date();

            return searchResults.items.map(item => {
                const video = videoMap.get(item.id.videoId);
                if (!video) return null;

                // durationì„ ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜í•˜ì—¬ ìˆí¼ ì—¬ë¶€ íŒë‹¨
                const durationInSeconds = parseDurationToSeconds(video.contentDetails.duration);
                const isShorts = durationInSeconds <= 60;

                // ê²Œì‹œì¼ë¡œë¶€í„° ê²½ê³¼ì¼ ê³„ì‚°
                const publishedDate = new Date(item.snippet.publishedAt);
                const daysAgo = Math.max(1, Math.floor((now - publishedDate) / (1000 * 60 * 60 * 24)));

                // ì¡°íšŒìˆ˜ ë° ì¢‹ì•„ìš”
                const viewCount = parseInt(video.statistics.viewCount || 0);
                const likeCount = parseInt(video.statistics.likeCount || 0);

                // ì¼í‰ê·  ì¡°íšŒìˆ˜
                const avgViewsPerDay = Math.round(viewCount / daysAgo);

                // ì°¸ì—¬ìœ¨ (ì¢‹ì•„ìš” / ì¡°íšŒìˆ˜ * 100)
                const engagementRate = viewCount > 0 ? ((likeCount / viewCount) * 100).toFixed(2) : 0;

                // ì„±ê³¼ ë“±ê¸‰ ê³„ì‚°
                const grade = calculateGrade(avgViewsPerDay, parseFloat(engagementRate), isShorts);

                return {
                    videoId: item.id.videoId,
                    title: item.snippet.title,
                    description: item.snippet.description,
                    tags: video.snippet.tags || [],
                    channel: item.snippet.channelTitle,
                    channelId: item.snippet.channelId,
                    publishedAt: item.snippet.publishedAt,
                    thumbnail: item.snippet.thumbnails.medium?.url || item.snippet.thumbnails.default?.url,
                    duration: video.contentDetails.duration,
                    durationFormatted: formatDuration(video.contentDetails.duration),
                    durationInSeconds: durationInSeconds,
                    isShorts: isShorts,
                    viewCount: viewCount,
                    likeCount: likeCount,
                    commentCount: parseInt(video.statistics.commentCount || 0),
                    daysAgo: daysAgo,
                    avgViewsPerDay: avgViewsPerDay,
                    engagementRate: parseFloat(engagementRate),
                    grade: grade
                };
            }).filter(item => item !== null);
        }

        /**
         * ì„±ê³¼ ë“±ê¸‰ ê³„ì‚°
         * @param {number} avgViews - ì¼í‰ê·  ì¡°íšŒìˆ˜
         * @param {number} engagement - ì°¸ì—¬ìœ¨ (%)
         * @param {boolean} isShorts - ìˆí¼ ì—¬ë¶€
         * @returns {string} ë“±ê¸‰ (Excellent, Good, Average, Poor)
         */
        function calculateGrade(avgViews, engagement, isShorts) {
            // ìˆí¼ì€ ê¸°ì¤€ì„ ë‹¤ë¥´ê²Œ ì ìš© (ë” ë†’ì€ ì¡°íšŒìˆ˜ í•„ìš”)
            const viewThreshold = isShorts ? 2 : 1;
            
            if (avgViews >= 10000 * viewThreshold || engagement >= 5.0) {
                return 'Excellent';
            } else if (avgViews >= 5000 * viewThreshold || engagement >= 3.0) {
                return 'Good';
            } else if (avgViews >= 1000 * viewThreshold || engagement >= 2.0) {
                return 'Average';
            } else {
                return 'Poor';
            }
        }

        /**
         * ISO 8601 durationì„ ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜
         * @param {string} duration - ISO 8601 í˜•ì‹
         * @returns {number} ì´ˆ ë‹¨ìœ„ ì‹œê°„
         */
        function parseDurationToSeconds(duration) {
            if (!duration) return 0;
            
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return 0;

            const hours = parseInt(match[1] || 0);
            const minutes = parseInt(match[2] || 0);
            const seconds = parseInt(match[3] || 0);

            return hours * 3600 + minutes * 60 + seconds;
        }

        /**
         * ë©”ì¸ ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
         * @param {Object} formData - í¼ ë°ì´í„°
         * @param {string|null} pageToken - í˜ì´ì§€ í† í°
         */
        async function performSearch(formData, pageToken = null) {
            try {
                showLoading(true);
                hideError();

                // API í‚¤ í™•ì¸
                if (YT_API_KEY === "YOUR_API_KEY_HERE") {
                    throw new Error("YouTube API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. ì½”ë“œ ìƒë‹¨ì˜ YT_API_KEY ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                }

                // ê²€ìƒ‰ í‚¤ì›Œë“œ ì €ì¥ (í•˜ì´ë¼ì´íŠ¸ìš©)
                appState.searchKeyword = formData.keyword || "";

                // 1ì°¨: search.list API í˜¸ì¶œ
                const params = buildSearchParams(formData, pageToken);
                const searchResults = await fetchSearch(params);

                // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
                if (!searchResults.items || searchResults.items.length === 0) {
                    appState.currentResults = [];
                    appState.filteredResults = [];
                    updateUI();
                    showError("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.");
                    return;
                }

                // ë¹„ë””ì˜¤ ID ì¶”ì¶œ
                const videoIds = searchResults.items.map(item => item.id.videoId);

                // 2ì°¨: videos.list API í˜¸ì¶œ
                const videoDetails = await fetchVideos(videoIds);

                // ê²°ê³¼ ë³‘í•©
                const mergedResults = mergeResults(searchResults, videoDetails);

                // ìƒíƒœ ì—…ë°ì´íŠ¸
                appState.currentResults = mergedResults;
                appState.filteredResults = [...mergedResults];
                appState.nextPageToken = searchResults.nextPageToken || null;
                appState.prevPageToken = searchResults.prevPageToken || null;
                appState.currentQuery = formData;

                // UI ì—…ë°ì´íŠ¸
                updateUI();

            } catch (error) {
                let errorMessage = "ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";

                if (error.message.includes("quota")) {
                    errorMessage = "âŒ API í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                } else if (error.message.includes("API")) {
                    errorMessage = `âŒ API ì˜¤ë¥˜: ${error.message}`;
                } else if (error.message.includes("NetworkError") || error.message.includes("Failed to fetch")) {
                    errorMessage = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
                } else {
                    errorMessage = `âŒ ${error.message}`;
                }

                showError(errorMessage);
            } finally {
                showLoading(false);
            }
        }

        // ========== UI ë Œë”ë§ í•¨ìˆ˜ ==========

        /**
         * í…Œì´ë¸” ë Œë”ë§
         */
        function renderTable() {
            const tbody = elements.resultsBody;
            tbody.innerHTML = "";

            if (appState.filteredResults.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" class="text-center" style="padding: 40px;">
                            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            appState.filteredResults.forEach(video => {
                const row = document.createElement("tr");
                
                // í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸
                const highlightedTitle = highlightKeyword(video.title, appState.searchKeyword);
                const highlightedDesc = highlightKeyword(video.description, appState.searchKeyword);
                const tagsText = video.tags.join(", ");
                const highlightedTags = highlightKeyword(tagsText, appState.searchKeyword);

                const formatBadge = video.isShorts 
                    ? '<span style="background: #ff0000; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;">ìˆí¼</span>'
                    : '<span style="background: #065fd4; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;">ë¡±í¼</span>';

                // ì„±ê³¼ ë“±ê¸‰ ìŠ¤íƒ€ì¼
                const gradeStyles = {
                    'Excellent': 'background: #4caf50; color: white;',
                    'Good': 'background: #8bc34a; color: white;',
                    'Average': 'background: #ff9800; color: white;',
                    'Poor': 'background: #f44336; color: white;'
                };
                const gradeBadge = `<span style="${gradeStyles[video.grade]} padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">${video.grade}</span>`;

                row.innerHTML = `
                    <td>
                        <div class="thumbnail-title-cell">
                            <div class="thumbnail-wrapper">
                                <img src="${video.thumbnail}" 
                                     alt="${escapeHtml(video.title)}" 
                                     loading="lazy">
                            </div>
                            <div class="title-content">
                                <a href="https://www.youtube.com/watch?v=${video.videoId}" 
                                   target="_blank" 
                                   class="video-title"
                                   rel="noopener noreferrer">
                                    ${highlightedTitle}
                                </a>
                            </div>
                        </div>
                    </td>
                    <td>${escapeHtml(video.channel)}</td>
                    <td>${formatDate(video.publishedAt)}</td>
                    <td>${video.daysAgo}ì¼</td>
                    <td>${formatBadge}</td>
                    <td>${video.durationFormatted}</td>
                    <td>${formatNumber(video.viewCount)}</td>
                    <td style="font-weight: 600; color: #4caf50;">${formatNumber(video.avgViewsPerDay)}</td>
                    <td>${formatNumber(video.likeCount)}</td>
                    <td>${video.engagementRate}%</td>
                    <td>${gradeBadge}</td>
                    <td><span class="video-tags">${highlightedTags}</span></td>
                `;

                tbody.appendChild(row);
            });
        }

        /**
         * ì¹´ë“œ ë·° ë Œë”ë§
         */
        function renderCards() {
            const container = elements.cardView;
            container.innerHTML = "";

            if (appState.filteredResults.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }

            appState.filteredResults.forEach(video => {
                const card = document.createElement("div");
                card.className = "video-card";

                const highlightedTitle = highlightKeyword(video.title, appState.searchKeyword);
                const formatBadge = video.isShorts ? 'ğŸ©³ ìˆí¼' : 'ğŸ¬ ë¡±í¼';
                const formatColor = video.isShorts ? '#ff0000' : '#065fd4';

                const gradeColors = {
                    'Excellent': '#4caf50',
                    'Good': '#8bc34a',
                    'Average': '#ff9800',
                    'Poor': '#f44336'
                };

                card.innerHTML = `
                    <img src="${video.thumbnail}" 
                         alt="${escapeHtml(video.title)}" 
                         class="card-thumbnail"
                         loading="lazy">
                    <div class="card-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="background: ${gradeColors[video.grade]}; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;">${video.grade}</span>
                            <span style="color: ${formatColor}; font-weight: bold; font-size: 0.85rem;">${formatBadge}</span>
                        </div>
                        <div class="card-title">
                            <a href="https://www.youtube.com/watch?v=${video.videoId}" 
                               target="_blank"
                               rel="noopener noreferrer">
                                ${highlightedTitle}
                            </a>
                        </div>
                        <div class="card-meta">
                            <span class="card-channel">${escapeHtml(video.channel)}</span>
                        </div>
                        <div class="card-stats">
                            <span>ğŸ‘ ${formatNumber(video.viewCount)}</span>
                            <span style="color: #4caf50; font-weight: 600;">ğŸ“Š ${formatNumber(video.avgViewsPerDay)}/ì¼</span>
                        </div>
                        <div class="card-stats">
                            <span>ğŸ‘ ${formatNumber(video.likeCount)}</span>
                            <span>ğŸ’¬ ${video.engagementRate}%</span>
                            <span>â± ${video.durationFormatted}</span>
                        </div>
                        <div class="card-stats">
                            <span>ğŸ“… ${formatDate(video.publishedAt)} (${video.daysAgo}ì¼ ì „)</span>
                        </div>
                    </div>
                `;

                card.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'A') {
                        window.open(`https://www.youtube.com/watch?v=${video.videoId}`, '_blank');
                    }
                });

                container.appendChild(card);
            });
        }

        /**
         * í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
         */
        function renderPager() {
            elements.prevBtn.disabled = !appState.prevPageToken;
            elements.nextBtn.disabled = !appState.nextPageToken;
            elements.pageInfo.textContent = `í˜ì´ì§€ ${appState.currentPage}`;
            
            if (appState.currentResults.length > 0) {
                elements.pagination.classList.add("show");
            } else {
                elements.pagination.classList.remove("show");
            }
        }

        /**
         * ì „ì²´ UI ì—…ë°ì´íŠ¸
         */
        function updateUI() {
            // ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ
            elements.resultCount.textContent = appState.filteredResults.length;
            
            if (appState.currentResults.length > 0) {
                elements.resultsInfo.classList.add("show");
                elements.controls.classList.remove("hidden");
            } else {
                elements.resultsInfo.classList.remove("show");
                elements.controls.classList.add("hidden");
            }

            // í˜„ì¬ ë·°ì— ë”°ë¼ ë Œë”ë§
            if (appState.currentView === "table") {
                renderTable();
                elements.tableView.style.display = "block";
                elements.cardView.classList.remove("show");
            } else {
                renderCards();
                elements.tableView.style.display = "none";
                elements.cardView.classList.add("show");
            }

            // í˜ì´ì§€ë„¤ì´ì…˜
            renderPager();
        }

        /**
         * ì •ë ¬ ì ìš©
         * @param {string} key - ì •ë ¬ í‚¤
         */
        function sortResults(key) {
            // ê°™ì€ í‚¤ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì •ë ¬ ìˆœì„œ ë³€ê²½
            if (appState.currentSortKey === key) {
                appState.currentSortOrder = appState.currentSortOrder === "asc" ? "desc" : "asc";
            } else {
                appState.currentSortKey = key;
                appState.currentSortOrder = "asc";
            }

            // ì •ë ¬ ìˆ˜í–‰
            appState.filteredResults.sort((a, b) => {
                let valA, valB;

                switch (key) {
                    case "title":
                        valA = a.title.toLowerCase();
                        valB = b.title.toLowerCase();
                        break;
                    case "channel":
                        valA = a.channel.toLowerCase();
                        valB = b.channel.toLowerCase();
                        break;
                    case "publishedAt":
                        valA = new Date(a.publishedAt);
                        valB = new Date(b.publishedAt);
                        break;
                    case "daysAgo":
                        valA = a.daysAgo;
                        valB = b.daysAgo;
                        break;
                    case "duration":
                        valA = a.duration;
                        valB = b.duration;
                        break;
                    case "viewCount":
                        valA = a.viewCount;
                        valB = b.viewCount;
                        break;
                    case "avgViews":
                        valA = a.avgViewsPerDay;
                        valB = b.avgViewsPerDay;
                        break;
                    case "likeCount":
                        valA = a.likeCount;
                        valB = b.likeCount;
                        break;
                    case "engagement":
                        valA = a.engagementRate;
                        valB = b.engagementRate;
                        break;
                    case "grade":
                        const gradeOrder = { 'Excellent': 4, 'Good': 3, 'Average': 2, 'Poor': 1 };
                        valA = gradeOrder[a.grade];
                        valB = gradeOrder[b.grade];
                        break;
                    default:
                        return 0;
                }

                if (valA < valB) return appState.currentSortOrder === "asc" ? -1 : 1;
                if (valA > valB) return appState.currentSortOrder === "asc" ? 1 : -1;
                return 0;
            });

            // í…Œì´ë¸” í—¤ë” UI ì—…ë°ì´íŠ¸
            document.querySelectorAll("th.sortable").forEach(th => {
                th.classList.remove("sort-asc", "sort-desc");
                if (th.dataset.sort === key) {
                    th.classList.add(`sort-${appState.currentSortOrder}`);
                }
            });

            updateUI();
        }

        /**
         * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§
         * @param {string} filterText - í•„í„° í…ìŠ¤íŠ¸
         */
        function applyClientFilter(filterText) {
            if (!filterText) {
                appState.filteredResults = [...appState.currentResults];
            } else {
                const lowerFilter = filterText.toLowerCase();
                appState.filteredResults = appState.currentResults.filter(video => {
                    return video.title.toLowerCase().includes(lowerFilter) ||
                           video.description.toLowerCase().includes(lowerFilter) ||
                           video.channel.toLowerCase().includes(lowerFilter) ||
                           video.tags.some(tag => tag.toLowerCase().includes(lowerFilter));
                });
            }
            updateUI();
        }

        // ========== ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ ==========

        /**
         * CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
         */
        function exportToCsv() {
            if (appState.filteredResults.length === 0) {
                alert("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // CSV í—¤ë”
            const headers = ["ì¸ë„¤ì¼URL", "ì œëª©", "ì±„ë„", "ê²Œì‹œì¼", "ê²½ê³¼ì¼", "í˜•ì‹", "ì¬ìƒì‹œê°„", "ì¡°íšŒìˆ˜", "ì¼í‰ê· ì¡°íšŒìˆ˜", "ì¢‹ì•„ìš”", "ì°¸ì—¬ìœ¨", "ì„±ê³¼ë“±ê¸‰", "íƒœê·¸"];
            
            // CSV í–‰
            const rows = appState.filteredResults.map(video => {
                return [
                    video.thumbnail,
                    escapeCsv(video.title),
                    escapeCsv(video.channel),
                    formatDate(video.publishedAt),
                    video.daysAgo + 'ì¼',
                    video.isShorts ? 'ìˆí¼' : 'ë¡±í¼',
                    video.durationFormatted,
                    formatNumber(video.viewCount),
                    formatNumber(video.avgViewsPerDay),
                    formatNumber(video.likeCount),
                    video.engagementRate + '%',
                    video.grade,
                    escapeCsv(video.tags.join(", "))
                ];
            });

            // CSV ìƒì„±
            const csvContent = [
                headers.join(","),
                ...rows.map(row => row.join(","))
            ].join("\n");

            // UTF-8 BOM ì¶”ê°€ (Excel í˜¸í™˜ì„±)
            const bom = "\uFEFF";
            const blob = new Blob([bom + csvContent], { type: "text/csv;charset=utf-8;" });
            
            // ë‹¤ìš´ë¡œë“œ
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `youtube_search_${Date.now()}.csv`);
            link.style.visibility = "hidden";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        /**
         * í´ë¦½ë³´ë“œë¡œ ì „ì²´ ë³µì‚¬ (TSV í˜•ì‹)
         */
        async function copyAllToClipboard() {
            if (appState.filteredResults.length === 0) {
                alert("ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // TSV í—¤ë”
            const headers = ["ì¸ë„¤ì¼URL", "ì œëª©", "ì±„ë„", "ê²Œì‹œì¼", "ê²½ê³¼ì¼", "í˜•ì‹", "ì¬ìƒì‹œê°„", "ì¡°íšŒìˆ˜", "ì¼í‰ê· ì¡°íšŒìˆ˜", "ì¢‹ì•„ìš”", "ì°¸ì—¬ìœ¨", "ì„±ê³¼ë“±ê¸‰", "íƒœê·¸"];
            
            // TSV í–‰
            const rows = appState.filteredResults.map(video => {
                return [
                    video.thumbnail,
                    video.title,
                    video.channel,
                    formatDate(video.publishedAt),
                    video.daysAgo + 'ì¼',
                    video.isShorts ? 'ìˆí¼' : 'ë¡±í¼',
                    video.durationFormatted,
                    formatNumber(video.viewCount),
                    formatNumber(video.avgViewsPerDay),
                    formatNumber(video.likeCount),
                    video.engagementRate + '%',
                    video.grade,
                    video.tags.join(", ")
                ].join("\t");
            });

            // TSV ìƒì„±
            const tsvContent = [headers.join("\t"), ...rows].join("\n");

            try {
                await navigator.clipboard.writeText(tsvContent);
                alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } catch (error) {
                console.error("Clipboard Error:", error);
                alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        }

        // ========== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ==========

        /**
         * ê²€ìƒ‰ í¼ ì œì¶œ ì´ë²¤íŠ¸
         */
        elements.searchForm.addEventListener("submit", (e) => {
            e.preventDefault();

            const formData = {
                keyword: document.getElementById("keyword").value.trim(),
                channelId: document.getElementById("channelId").value.trim(),
                publishedAfter: document.getElementById("publishedAfter").value,
                publishedBefore: document.getElementById("publishedBefore").value,
                order: document.getElementById("order").value,
                maxResults: document.getElementById("maxResults").value
            };

            // í‚¤ì›Œë“œ ë˜ëŠ” ì±„ë„ID ì¤‘ í•˜ë‚˜ëŠ” í•„ìˆ˜
            if (!formData.keyword && !formData.channelId) {
                showError("ê²€ìƒ‰ í‚¤ì›Œë“œ ë˜ëŠ” ì±„ë„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // í˜ì´ì§€ ì´ˆê¸°í™”
            appState.currentPage = 1;
            appState.nextPageToken = null;
            appState.prevPageToken = null;

            performSearch(formData);
        });

        /**
         * ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
         */
        elements.resetBtn.addEventListener("click", () => {
            elements.searchForm.reset();
            hideError();
            appState.currentResults = [];
            appState.filteredResults = [];
            updateUI();
        });

        /**
         * ì´ì „ í˜ì´ì§€ ë²„íŠ¼
         */
        elements.prevBtn.addEventListener("click", () => {
            if (appState.prevPageToken && appState.currentQuery) {
                appState.currentPage--;
                performSearch(appState.currentQuery, appState.prevPageToken);
            }
        });

        /**
         * ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
         */
        elements.nextBtn.addEventListener("click", () => {
            if (appState.nextPageToken && appState.currentQuery) {
                appState.currentPage++;
                performSearch(appState.currentQuery, appState.nextPageToken);
            }
        });

        /**
         * í…Œì´ë¸”/ì¹´ë“œ ë·° í† ê¸€
         */
        elements.tableViewBtn.addEventListener("click", () => {
            appState.currentView = "table";
            elements.tableViewBtn.classList.add("active");
            elements.cardViewBtn.classList.remove("active");
            updateUI();
        });

        elements.cardViewBtn.addEventListener("click", () => {
            appState.currentView = "card";
            elements.cardViewBtn.classList.add("active");
            elements.tableViewBtn.classList.remove("active");
            updateUI();
        });

        /**
         * í…Œì´ë¸” í—¤ë” í´ë¦­ (ì •ë ¬)
         */
        document.querySelectorAll("th.sortable").forEach(th => {
            th.addEventListener("click", () => {
                const sortKey = th.dataset.sort;
                sortResults(sortKey);
            });
        });

        /**
         * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°
         */
        elements.clientFilter.addEventListener("input", (e) => {
            applyClientFilter(e.target.value.trim());
        });

        elements.clearFilterBtn.addEventListener("click", () => {
            elements.clientFilter.value = "";
            applyClientFilter("");
        });

        /**
         * CSV ë‚´ë³´ë‚´ê¸°
         */
        elements.exportCsvBtn.addEventListener("click", exportToCsv);

        /**
         * ì „ì²´ ë³µì‚¬
         */
        elements.copyAllBtn.addEventListener("click", copyAllToClipboard);

        /**
         * í‚¤ë³´ë“œ ì ‘ê·¼ì„± (Enter í‚¤ë¡œ ê²€ìƒ‰)
         */
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                    elements.searchForm.dispatchEvent(new Event('submit'));
                }
            });
        });

        // ========== ì´ˆê¸°í™” ==========
        
        console.log("MoneyShift YouTube View LABì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");
        console.log("API í‚¤ë¥¼ ì„¤ì •í•˜ê³  ê²€ìƒ‰ì„ ì‹œì‘í•˜ì„¸ìš”!");

        // API í‚¤ ì²´í¬
        if (YT_API_KEY === "YOUR_API_KEY_HERE") {
            showError("âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½”ë“œ ìƒë‹¨ì˜ YT_API_KEY ë³€ìˆ˜ë¥¼ ë³¸ì¸ì˜ YouTube Data API v3 í‚¤ë¡œ êµì²´í•˜ì„¸ìš”.");
        }

    </script>
</body>
</html>